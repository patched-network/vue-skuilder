name: ci-linting
permissions:
  contents: read

on:
  push:
    branches:
      - main
      - master
  pull_request:
    branches:
      - main
      - master

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: 'yarn'

      - name: Install Yarn
        run: corepack enable

      - name: Install dependencies
        run: yarn install --immutable

      - name: Run linting on all packages
        run: |
          set +e  # Don't exit on first failure
          EXIT_CODE=0

          echo "ğŸ” Linting all packages..."
          echo ""

          # Backend packages
          echo "ğŸ“¦ Linting @vue-skuilder/common..."
          yarn workspace @vue-skuilder/common lint:check
          if [ $? -ne 0 ]; then EXIT_CODE=1; echo "âŒ @vue-skuilder/common FAILED"; else echo "âœ… @vue-skuilder/common passed"; fi
          echo ""

          echo "ğŸ“¦ Linting @vue-skuilder/db..."
          yarn workspace @vue-skuilder/db lint:check
          if [ $? -ne 0 ]; then EXIT_CODE=1; echo "âŒ @vue-skuilder/db FAILED"; else echo "âœ… @vue-skuilder/db passed"; fi
          echo ""

          echo "ğŸ“¦ Linting @vue-skuilder/express..."
          yarn workspace @vue-skuilder/express lint:check
          if [ $? -ne 0 ]; then EXIT_CODE=1; echo "âŒ @vue-skuilder/express FAILED"; else echo "âœ… @vue-skuilder/express passed"; fi
          echo ""

          echo "ğŸ“¦ Linting @vue-skuilder/cli..."
          yarn workspace @vue-skuilder/cli lint:check
          if [ $? -ne 0 ]; then EXIT_CODE=1; echo "âŒ @vue-skuilder/cli FAILED"; else echo "âœ… @vue-skuilder/cli passed"; fi
          echo ""

          echo "ğŸ“¦ Linting @vue-skuilder/e2e-db..."
          yarn workspace @vue-skuilder/e2e-db lint:check
          if [ $? -ne 0 ]; then EXIT_CODE=1; echo "âŒ @vue-skuilder/e2e-db FAILED"; else echo "âœ… @vue-skuilder/e2e-db passed"; fi
          echo ""

          # Frontend packages
          echo "ğŸ“¦ Linting @vue-skuilder/common-ui..."
          yarn workspace @vue-skuilder/common-ui lint:check
          if [ $? -ne 0 ]; then EXIT_CODE=1; echo "âŒ @vue-skuilder/common-ui FAILED"; else echo "âœ… @vue-skuilder/common-ui passed"; fi
          echo ""

          echo "ğŸ“¦ Linting @vue-skuilder/platform-ui..."
          yarn workspace @vue-skuilder/platform-ui lint:check
          if [ $? -ne 0 ]; then EXIT_CODE=1; echo "âŒ @vue-skuilder/platform-ui FAILED"; else echo "âœ… @vue-skuilder/platform-ui passed"; fi
          echo ""

          echo "ğŸ“¦ Linting @vue-skuilder/studio-ui..."
          yarn workspace @vue-skuilder/studio-ui lint:check
          if [ $? -ne 0 ]; then EXIT_CODE=1; echo "âŒ @vue-skuilder/studio-ui FAILED"; else echo "âœ… @vue-skuilder/studio-ui passed"; fi
          echo ""

          echo "ğŸ“¦ Linting @vue-skuilder/courseware..."
          yarn workspace @vue-skuilder/courseware lint:check
          if [ $? -ne 0 ]; then EXIT_CODE=1; echo "âŒ @vue-skuilder/courseware FAILED"; else echo "âœ… @vue-skuilder/courseware passed"; fi
          echo ""

          echo "TODO: ğŸ“¦ add inting for @vue-skuilder/mcp..."
          echo ""

          # Summary and exit with collected status
          echo "================================"
          if [ $EXIT_CODE -eq 0 ]; then
            echo "âœ… All packages passed linting"
          else
            echo "âŒ One or more packages failed linting"
            echo "Review the output above for details"
          fi
          echo "================================"

          exit $EXIT_CODE
